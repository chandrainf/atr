<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Column Chart with Filters</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts">
  <style>
    #filters {
      margin-bottom: 20px;
    }
    #filters select, #filters button {
      margin-right: 10px;
    }
    #data-table {
      display: none;
    }
    .active {
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <div id="filters">
    <select id="locationFilter">
      <option value="">All Locations</option>
    </select>
    <button id="weeklyFilter">Weekly</button>
    <button id="monthlyFilter">Monthly</button>
  </div>
  <div id="chart"></div>

  <table id="data-table">
    <thead>
      <tr>
        <th>Status</th>
        <th>Kiosk Number</th>
        <th>Location</th>
        <th>Error Time</th>
        <th>Number of Errors</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Active</td>
        <td>001</td>
        <td>Location1</td>
        <td>2024-01-15T10:00:00Z</td>
        <td>5</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>002</td>
        <td>Location2</td>
        <td>2024-02-16T11:00:00Z</td>
        <td>3</td>
      </tr>
      <tr>
        <td>Active</td>
        <td>003</td>
        <td>Location3</td>
        <td>2024-03-17T12:00:00Z</td>
        <td>8</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>004</td>
        <td>Location1</td>
        <td>2024-04-18T13:00:00Z</td>
        <td>2</td>
      </tr>
      <tr>
        <td>Active</td>
        <td>005</td>
        <td>Location2</td>
        <td>2024-05-19T14:00:00Z</td>
        <td>4</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>006</td>
        <td>Location3</td>
        <td>2024-06-20T15:00:00Z</td>
        <td>6</td>
      </tr>
      <tr>
        <td>Active</td>
        <td>007</td>
        <td>Location1</td>
        <td>2024-07-21T16:00:00Z</td>
        <td>7</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>008</td>
        <td>Location2</td>
        <td>2024-08-22T17:00:00Z</td>
        <td>1</td>
      </tr>
      <tr>
        <td>Active</td>
        <td>009</td>
        <td>Location3</td>
        <td>2024-09-23T18:00:00Z</td>
        <td>9</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>010</td>
        <td>Location1</td>
        <td>2024-10-24T19:00:00Z</td>
        <td>5</td>
      </tr>
      <tr>
        <td>Active</td>
        <td>011</td>
        <td>Location2</td>
        <td>2024-11-25T20:00:00Z</td>
        <td>3</td>
      </tr>
      <tr>
        <td>Inactive</td>
        <td>012</td>
        <td>Location3</td>
        <td>2024-12-26T21:00:00Z</td>
        <td>4</td>
      </tr>
    </tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dataTable = document.getElementById('data-table');
      let data = [];

      const parseTableData = () => {
        const rows = dataTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const cells = row.querySelectorAll('td');
          data.push({
            status: cells[0].textContent,
            kioskNumber: cells[1].textContent,
            location: cells[2].textContent,
            errorTime: cells[3].textContent,
            numberOfErrors: parseInt(cells[4].textContent)
          });
        });
      };

      let filteredData = [...data];
      const locationFilter = document.getElementById('locationFilter');
      const weeklyFilterButton = document.getElementById('weeklyFilter');
      const monthlyFilterButton = document.getElementById('monthlyFilter');

      const initializeLocationFilter = () => {
        const locations = [...new Set(data.map(item => item.location))];
        locations.forEach(location => {
          const option = document.createElement('option');
          option.value = location;
          option.textContent = location;
          locationFilter.appendChild(option);
        });
      };

      const filterData = () => {
        const selectedLocation = locationFilter.value;
        const now = new Date();
        let startOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + 1)); // Start of the week (Monday)
        let endOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + 7)); // End of the week (Sunday)
        const oneMonthAgo = new Date(now);
        oneMonthAgo.setMonth(now.getMonth() - 1);

        // Reset to start of week and end of week if weekly filter is active
        if (weeklyFilterButton.classList.contains('active')) {
          startOfWeek = new Date();
          startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay() + 1);
          endOfWeek = new Date(startOfWeek);
          endOfWeek.setDate(startOfWeek.getDate() + 6);
        }
        
        filteredData = data.filter(item => {
          const errorTime = new Date(item.errorTime);
          if (selectedLocation && item.location !== selectedLocation) return false;
          if (weeklyFilterButton.classList.contains('active') && (errorTime < startOfWeek || errorTime > endOfWeek)) return false;
          if (monthlyFilterButton.classList.contains('active') && errorTime < oneMonthAgo) return false;
          return true;
        });

        updateChart();
      };

      const updateChart = () => {
        const monthlyErrors = Array(12).fill(0);
        filteredData.forEach(item => {
          const month = new Date(item.errorTime).getMonth();
          monthlyErrors[month] += item.numberOfErrors;
        });

        const options = {
          series: [{
            name: 'Errors',
            data: monthlyErrors
          }],
          chart: {
            type: 'bar',
            height: 350
          },
          plotOptions: {
            bar: {
              horizontal: false
            }
          },
          xaxis: {
            categories: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
          }
        };

        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
      };

      locationFilter.addEventListener('change', filterData);
      weeklyFilterButton.addEventListener('click', () => {
        weeklyFilterButton.classList.add('active');
        monthlyFilterButton.classList.remove('active');
        filterData();
      });
      monthlyFilterButton.addEventListener('click', () => {
        monthlyFilterButton.classList.add('active');
        weeklyFilterButton.classList.remove('active');
        filterData();
      });

      parseTableData();
      initializeLocationFilter();
      filterData(); // Initial chart render
    });
  </script>
</body>
</html>
