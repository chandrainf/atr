<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiosk Error Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
</head>
<body>
  <div id="chart"></div>
  <select id="location-filter"></select>
  <button id="filter-weekly" class="active">Weekly</button>
  <button id="filter-monthly">Monthly</button>

  <script>
    // Data (replace with your actual data fetching logic)
    const chartData = [
      { status: "Failed", kioskNumber: 1, location: "Store A", errorTime: new Date("2024-06-03"), numberOfErrors: 5 },
      { status: "Success", kioskNumber: 2, location: "Store B", errorTime: new Date("2024-06-04"), numberOfErrors: 2 },
      // ... more data entries
    ];

    // Function to filter data based on location and timeframe
    function filterData(location, timeframe) {
      return chartData.filter((entry) => {
        const isLocationMatch = location === "all" || entry.location === location;
        const isTimeframeMatch = timeframe === "weekly"
          ? entry.errorTime.getDate() >= new Date().getDate() - 7
          : true; // Monthly timeframe includes all data
        return isLocationMatch && isTimeframeMatch;
      });
    }

    // Function to generate chart options
    function getChartOptions(data) {
      return {
        chart: {
          type: "bar",
        },
        series: [{
          name: "Number of Errors",
          data: data.map((entry) => entry.numberOfErrors),
        }],
        xaxis: {
          categories: data.map((entry) => entry.kioskNumber),
        },
        title: {
          text: `Number of Errors by Kiosk - ${locationFilter.value}`,
        },
        dataLabels: {
          enabled: false, // Optional: disable data labels on bars
        },
      };
    }

    // Location dropdown population (replace with your data source)
    const locations = ["all", "Store A", "Store B", /* ... more locations */];
    const locationFilter = document.getElementById("location-filter");
    locations.forEach((location) => {
      const option = document.createElement("option");
      option.value = location;
      option.text = location;
      locationFilter.appendChild(option);
    });

    // Initial chart render
    const initialData = filterData("all", "weekly");
    const chart = new ApexCharts(document.getElementById("chart"), getChartOptions(initialData));
    chart.render();

    // Filter buttons functionality
    const filterWeeklyButton = document.getElementById("filter-weekly");
    const filterMonthlyButton = document.getElementById("filter-monthly");

    filterWeeklyButton.addEventListener("click", () => {
      const filteredData = filterData(locationFilter.value, "weekly");
      chart.updateOptions(getChartOptions(filteredData));
      filterWeeklyButton.classList.add("active");
      filterMonthlyButton.classList.remove("active");
    });

    filterMonthlyButton.addEventListener("click", () => {
      const filteredData = filterData(locationFilter.value, "monthly");
      chart.updateOptions(getChartOptions(filteredData));
      filterMonthlyButton.classList.add("active");
      filterWeeklyButton.classList.remove("active");
    });

    // Location filter change handler
    locationFilter.addEventListener("change", () => {
      const filteredData = filterData(locationFilter.value, filterWeeklyButton.classList.contains("active") ? "weekly" : "monthly");
      chart.updateOptions(getChartOptions(filteredData));
    });
  </script>
</body>
</html>
