<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiosk Error Chart</title>
  <!-- Include ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <div>
        <label for="locationFilter">Location:</label>
        <select id="locationFilter">
          <!-- Populate with options dynamically based on your data -->
          <option value="Location 1">Location 1</option>
          <option value="Location 2">Location 2</option>
          <!-- Add more options as needed -->
        </select>
        <label for="errorFilter">Error Filter:</label>
        <select id="errorFilter">
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
      </div>
  <div id="chart"></div>
  
  <!-- Sample table for data -->
  <table id="data-table">
    <thead>
      <tr>
        <th>Kiosk</th>
        <th>Location</th>
        <th>Error Date</th>
        <th>Number of Errors</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Kiosk 1</td>
        <td>Location 1</td>
        <td>2024-01-05</td>
        <td>3</td>
      </tr>
      <tr>
        <td>Kiosk 2</td>
        <td>Location 2</td>
        <td>2024-02-15</td>
        <td>5</td>
      </tr>
      <tr>
        <td>Kiosk 3</td>
        <td>Location 1</td>
        <td>2024-03-20</td>
        <td>7</td>
      </tr>
      <!-- Add more rows as needed -->
    </tbody>
  </table>

  <script>
    // Initialize chart options
    const chartOptions = {
      chart: {
        type: 'bar'
      },
      xaxis: {
        categories: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
      },
      // Add more options as needed
    };

    // Function to retrieve data from table
    function getDataFromTable() {
      const tableRows = document.querySelectorAll('#data-table tbody tr');
      const data = [];
      tableRows.forEach(row => {
        const rowData = {
          kiosk: row.cells[0].innerText,
          location: row.cells[1].innerText,
          errorDate: row.cells[2].innerText,
          numErrors: parseInt(row.cells[3].innerText)
        };
        data.push(rowData);
      });
      return data;
    }

    // Function to filter data based on location
    function filterDataByLocation(data, location) {
      return data.filter(entry => entry.location === location);
    }

    // Function to filter data based on error filter (weekly or monthly)
    function filterDataByErrorFilter(data, filterType) {
      if (filterType === 'weekly') {
        // Implement weekly filtering logic
      } else if (filterType === 'monthly') {
        // Implement monthly filtering logic
      }
      return data;
    }

    // Function to render the chart
    function renderChart(data) {
      const numErrors = data.map(entry => entry.numErrors);
      const chart = new ApexCharts(document.querySelector("#chart"), {
        ...chartOptions,
        series: [{ data: numErrors }]
      });
      chart.render();
    }

    // Function to update the chart based on filters
    function updateChart(location, errorFilter) {
      const data = getDataFromTable();
      let filteredData = filterDataByLocation(data, location);
      filteredData = filterDataByErrorFilter(filteredData, errorFilter);
      renderChart(filteredData);
    }

    // Initial render of the chart
    updateChart('Location 1', 'weekly'); // Default values

    // Event listeners for filter changes
    document.getElementById('locationFilter').addEventListener('change', function() {
      const location = this.value;
      const errorFilter = document.getElementById('errorFilter').value;
      updateChart(location, errorFilter);
    });

    document.getElementById('errorFilter').addEventListener('change', function() {
      const errorFilter = this.value;
      const location = document.getElementById('locationFilter').value;
      updateChart(location, errorFilter);
    });
  </script>
</body>
</html>
