<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Earthquake Map</title>
    <style>
      #map {
        height: 500px;
        width: 100%;
      }
      .legend {
        background: white;
        padding: 10px;
      }
      .legend-item {
        margin-bottom: 5px;
      }
      .legend-color {
        display: inline-block;
        width: 12px;
        height: 12px;
        margin-right: 5px;
      }
      .tooltip {
        display: inline;
      }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <div id="map"></div>

    <table id="earthquakeTable" style="display: none">
      <thead>
        <tr>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Magnitude</th>
          <th>Location</th>
          <th>Status</th>
          <th>Datetime</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>-6.200000</td>
          <td>106.816666</td>
          <td>4.5</td>
          <td>Jakarta</td>
          <td>normal</td>
          <td>2024-06-12T19:44:00+07:00</td>
          <!-- 1 hour ago -->
        </tr>
        <tr>
          <td>-8.340539</td>
          <td>115.092217</td>
          <td>5.2</td>
          <td>Bali</td>
          <td>maintenance</td>
          <td>2024-06-12T18:00:00+07:00</td>
          <!-- 2 hours ago -->
        </tr>
        <tr>
          <td>-7.250445</td>
          <td>112.768845</td>
          <td>6.0</td>
          <td>Surabaya</td>
          <td>error</td>
          <td>2024-06-11T18:00:00+07:00</td>
          <!-- 1 day ago -->
        </tr>
        <tr>
          <td>-7.795580</td>
          <td>110.369490</td>
          <td>4.8</td>
          <td>Yogyakarta</td>
          <td>normal</td>
          <td>2024-06-05T18:00:00+07:00</td>
          <!-- 1 week ago -->
        </tr>
        <tr>
          <td>-3.597031</td>
          <td>128.262122</td>
          <td>5.5</td>
          <td>Ambon</td>
          <td>maintenance</td>
          <td>2023-06-12T18:00:00+07:00</td>
          <!-- 1 year ago -->
        </tr>
      </tbody>
    </table>

    <script>
      // Initialize the map centered on Indonesia
      var map = L.map("map").setView([-2.5, 118.0], 5); // Central coordinates of Indonesia

      // Add the base layer from OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      function timeSince(date) {
        var now = new Date();
        var timezoneOffset = now.getTimezoneOffset() * 60000; // Get local timezone offset in milliseconds
        var localNow = now - timezoneOffset; // Convert current time to local time

        var datetime = new Date(date).getTime();
        var localDatetime = datetime - (timezoneOffset + 25200000); // Convert provided datetime to local time (WIB: UTC+07:00)

        var seconds = Math.floor((localNow - localDatetime) / 1000);

        var interval = Math.floor(seconds / 31536000);
        if (interval >= 1) {
          return interval + " year" + (interval > 1 ? "s" : "") + " ago";
        }

        interval = Math.floor(seconds / 2592000);
        if (interval >= 1) {
          return interval + " month" + (interval > 1 ? "s" : "") + " ago";
        }

        interval = Math.floor(seconds / 86400);
        if (interval >= 1) {
          return interval + " day" + (interval > 1 ? "s" : "") + " ago";
        }

        interval = Math.floor(seconds / 3600);
        if (interval >= 1) {
          return interval + " hour" + (interval > 1 ? "s" : "") + " ago";
        }

        interval = Math.floor(seconds / 60);
        if (interval >= 1) {
          return interval + " minute" + (interval > 1 ? "s" : "") + " ago";
        }

        return "Just now";
      }

      // Add earthquake markers to the map
      function addEarthquakeMarkers() {
        var tableRows = document.querySelectorAll("#earthquakeTable tbody tr");
        tableRows.forEach(function (row) {
          var cells = row.querySelectorAll("td");
          var latitude = parseFloat(cells[0].textContent);
          var longitude = parseFloat(cells[1].textContent);
          var magnitude = parseFloat(cells[2].textContent);
          var location = cells[3].textContent;
          var status = cells[4].textContent.toLowerCase();
          var datetime = cells[5].textContent;

          var earthquakeMarker = L.marker([latitude, longitude]).addTo(map);

          var popupContent =
            "Earthquake Location: " +
            location +
            "<br>Magnitude: " +
            magnitude +
            "<br>Status: " +
            status +
            "<br>Time: " +
            timeSince(datetime);

          earthquakeMarker.bindPopup(popupContent);
        });
      }

      // Call the function to add markers when the page loads
      window.onload = addEarthquakeMarkers;
    </script>
  </body>
</html>
